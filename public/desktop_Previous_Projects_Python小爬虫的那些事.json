{"data": "---\ntitle: Python\u5c0f\u722c\u866b\u7684\u90a3\u4e9b\u4e8b\ndate: 2013/9/10 15:41:44\ntags:\n- Life\n- work\n- python\n- \u722c\u866b\n\n---\n\n\n## Python\n\n\n\u4ece\u63a5\u89e6\u8ba1\u7b97\u673a\u4ee5\u6765\uff0c\u4e00\u76f4\u90fd\u6709\u7740\u60f3\u6df1\u5165\u4e86\u89e3\u4e00\u95e8\u8bed\u8a00\u3002\u4e5f\u662f\u56e0\u4e3a\u6709\u505a\u7740\u7f51\u7edc\u7535\u5546\u7684\u539f\u56e0\u5427\uff0c\u5e97\u5bb6\u6bcf\u5929\u90fd\u4e00\u76f4\u7ef4\u62a4\u5e72\u7740\u540c\u6837\u6216\u8005\u662f\u7c7b\u4f3c\u6d41\u6c34\u7ebf\u5f0f\u7684\u5de5\u4f5c,\u6bcf\u5929\u5f97\u4e0a\u4f20\u81ea\u5df1\u7684\u4ea7\u54c1\u4fee\u6539\u7740\u5b9d\u8d1d\u8be6\u7ec6\u91cc\u7684\u63cf\u8ff0\uff0c\u6709\u65f6\u4e5f\u5f97\u89c2\u5bdf\u7740\u540c\u884c\u7684\u4e00\u4e3e\u4e00\u52a8\u3002\u8ba9\u6211\u62e5\u6709\u4e86\u60f3\u505a\u4e00\u4e2a\u771f\u6b63\u811a\u672c\u7684\u60f3\u6cd5\u5ff5\u5934\uff0c\u89e3\u653e\u81ea\u5df1\u7684\u52b3\u52a8\u529b\uff01\n\u4fd7\u8bdd\u8bf4\u7684\u597d\u89e3\u653e\u52b3\u52a8\u529b\u624d\u80fd\u589e\u5927\u81ea\u5df1\u7684\u751f\u4ea7\u91cc\uff0c\u4ece\u7410\u788e\u4e8b\u91cc\u6446\u8131\uff0c\u505a\u7740\u8ba4\u4e3a\u5bf9\u81ea\u5df1\u6709\u7528\u7684\u4e8b\u60c5\u624d\u80fd\u589e\u957f\u3002\n\nPython\u6293\u53d6\u7f51\u9875\u65b9\u6cd5\uff0c\u4efb\u52a1\u662f\u6279\u91cf\u4e0b\u8f7d\u7f51\u7ad9\u4e0a\u7684\u6587\u4ef6\u3002\u5bf9\u4e8e\u4e00\u4e2a\u521a\u521a\u5165\u95e8python\u7684\u4eba\u6765\u8bf4\uff0c\u5728\u5f88\u591a\u7ec6\u8282\u4e0a\u90fd\u6709\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\uff0c\u4ee5\u4e0b\u5c31\u5206\u4eab\u4e00\u4e0b\u5728\u521d\u5b66python\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u95ee\u9898\u53ca\u89e3\u51b3\u65b9\u6cd5\u3002\n\u5b66\u4e60Python\uff0c\u5f53\u7136\u5c11\u4e0d\u4e86\u73af\u5883\u7684\u914d\u7f6e\uff0c\u6700\u521d\u6211\u7528\u7684\u662fNotepad++\uff0c\u4e0d\u8fc7\u53d1\u73b0\u5b83\u7684\u63d0\u793a\u529f\u80fd\u5b9e\u5728\u662f\u592a\u5f31\u4e86\uff0c\u4e8e\u662f\uff0c\u5728Windows\u4e0b\u6211\u7528\u4e86PyCharm\uff0c\u5728Linux\u4e0b\u6211\u7528\u4e86Eclipse for Python\uff0c\u53e6\u5916\u8fd8\u6709\u51e0\u6b3e\u6bd4\u8f83\u4f18\u79c0\u7684IDE\n\n## urllib\u5e93\n Python\u4e07\u80fd\u7684\u80f6\u6c34\u8bed\u8a00\u4f7f\u5f97\u8ba9\u5b83\u6709\u66f4\u5927\u7684\u6d3b\u529b\uff0c\u4ee5\u81f3\u4e8e\u5728\u722c\u866b\u8fd9\u4e2a\u9886\u57df\u4e2d\u4e5f\u8bde\u751f\u7684\u5f88\u591a\u5e93\u3002\n\n    response = urllib2.urlopen(\"http://www.baidu.com\")\n    urlopen(url, data, timeout)\n    print response.read()\n\n    import urllib2\n\n    request = urllib2.Request(\"http://www.baidu.com\")\n    response = urllib2.urlopen(request)\n    print response.read()\n    \n\n    \n\u90a3\u4e48\u5c31\u5f00\u59cb\u5427\n\n\n    import urllib\n    import urllib2\n    import re\n    import tool\n    import os\n\n#\u6293\u53d6\u4e70\u5bb6\u4e3b\u9875\u4e2a\u4eba\u4ecb\u7ecd\n```python\nclass Spider:\n\n    #\u9875\u9762\u521d\u59cb\u5316\n    def __init__(self):\n        self.siteURL = 'http://mm.taobao.com/json/request_top_list.htm'\n        self.tool = tool.Tool()\n\n    #\u83b7\u53d6\u7d22\u5f15\u9875\u9762\u7684\u5185\u5bb9\n    def getPage(self,pageIndex):\n        url = self.siteURL + \"?page=\" + str(pageIndex)\n        request = urllib2.Request(url)\n        response = urllib2.urlopen(request)\n        return response.read().decode('gbk')\n\n    #\u83b7\u53d6\u7d22\u5f15\u754c\u9762\u6240\u6709\u7684\u4fe1\u606f\uff0clist\u683c\u5f0f\n    def getContents(self,pageIndex):\n        page = self.getPage(pageIndex)\n        pattern = re.compile('<div class=\"list-item\".*?pic-word.*?<a href=\"(.*?)\".*?<img src=\"(.*?)\".*?<a class=\"lady-name.*?>(.*?)</a>.*?<strong>(.*?)</strong>.*?<span>(.*?)</span>',re.S)\n        items = re.findall(pattern,page)\n        contents = []\n        for item in items:\n            contents.append([item[0],item[1],item[2],item[3],item[4]])\n        return contents\n\n    #\u83b7\u53d6MM\u4e2a\u4eba\u8be6\u60c5\u9875\u9762\n    def getDetailPage(self,infoURL):\n        response = urllib2.urlopen(infoURL)\n        return response.read().decode('gbk')\n\n    #\u83b7\u53d6\u4e2a\u4eba\u6587\u5b57\u7b80\u4ecb\n    def getBrief(self,page):\n        pattern = re.compile('<div class=\"mm-aixiu-content\".*?>(.*?)<!--',re.S)\n        result = re.search(pattern,page)\n        return self.tool.replace(result.group(1))\n\n    #\u83b7\u53d6\u9875\u9762\u6240\u6709\u56fe\u7247\n    def getAllImg(self,page):\n        pattern = re.compile('<div class=\"mm-aixiu-content\".*?>(.*?)<!--',re.S)\n        #\u4e2a\u4eba\u4fe1\u606f\u9875\u9762\u6240\u6709\u4ee3\u7801\n        content = re.search(pattern,page)\n        #\u4ece\u4ee3\u7801\u4e2d\u63d0\u53d6\u56fe\u7247\n        patternImg = re.compile('<img.*?src=\"(.*?)\"',re.S)\n        images = re.findall(patternImg,content.group(1))\n        return images\n\n\n    #\u4fdd\u5b58\u591a\u5f20\u56fe\u7247\n    def saveImgs(self,images,name):\n        number = 1\n        print u\"\u53d1\u73b0\",name,u\"\u5171\u6709\",len(images),u\"\u5f20\u7167\u7247\"\n        for imageURL in images:\n            splitPath = imageURL.split('.')\n            fTail = splitPath.pop()\n            if len(fTail) > 3:\n                fTail = \"jpg\"\n            fileName = name + \"/\" + str(number) + \".\" + fTail\n            self.saveImg(imageURL,fileName)\n            number += 1\n\n    # \u4fdd\u5b58\u5934\u50cf\n    def saveIcon(self,iconURL,name):\n        splitPath = iconURL.split('.')\n        fTail = splitPath.pop()\n        fileName = name + \"/icon.\" + fTail\n        self.saveImg(iconURL,fileName)\n\n    #\u4fdd\u5b58\u4e2a\u4eba\u7b80\u4ecb\n    def saveBrief(self,content,name):\n        fileName = name + \"/\" + name + \".txt\"\n        f = open(fileName,\"w+\")\n        print u\"\u6b63\u5728\u5077\u5077\u4fdd\u5b58\u5979\u7684\u4e2a\u4eba\u4fe1\u606f\u4e3a\",fileName\n        f.write(content.encode('utf-8'))\n\n\n    #\u4f20\u5165\u56fe\u7247\u5730\u5740\uff0c\u6587\u4ef6\u540d\uff0c\u4fdd\u5b58\u5355\u5f20\u56fe\u7247\n    def saveImg(self,imageURL,fileName):\n         u = urllib.urlopen(imageURL)\n         data = u.read()\n         f = open(fileName, 'wb')\n         f.write(data)\n         print u\"\u6b63\u5728\u6084\u6084\u4fdd\u5b58\u5979\u7684\u4e00\u5f20\u56fe\u7247\u4e3a\",fileName\n         f.close()\n\n    #\u521b\u5efa\u65b0\u76ee\u5f55\n    def mkdir(self,path):\n        path = path.strip()\n        # \u5224\u65ad\u8def\u5f84\u662f\u5426\u5b58\u5728\n        # \u5b58\u5728     True\n        # \u4e0d\u5b58\u5728   False\n        isExists=os.path.exists(path)\n        # \u5224\u65ad\u7ed3\u679c\n        if not isExists:\n            # \u5982\u679c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u76ee\u5f55\n            print u\"\u5077\u5077\u65b0\u5efa\u4e86\u540d\u5b57\u53eb\u505a\",path,u'\u7684\u6587\u4ef6\u5939'\n            # \u521b\u5efa\u76ee\u5f55\u64cd\u4f5c\u51fd\u6570\n            os.makedirs(path)\n            return True\n        else:\n            # \u5982\u679c\u76ee\u5f55\u5b58\u5728\u5219\u4e0d\u521b\u5efa\uff0c\u5e76\u63d0\u793a\u76ee\u5f55\u5df2\u5b58\u5728\n            print u\"\u540d\u4e3a\",path,'\u7684\u6587\u4ef6\u5939\u5df2\u7ecf\u521b\u5efa\u6210\u529f'\n            return False\n\n    #\u5c06\u4e00\u9875\u6dd8\u5b9dMM\u7684\u4fe1\u606f\u4fdd\u5b58\u8d77\u6765\n    def savePageInfo(self,pageIndex):\n        #\u83b7\u53d6\u7b2c\u4e00\u9875\u6dd8\u5b9d\u5217\u8868\n        contents = self.getContents(pageIndex)\n        for item in contents:\n            #item[0]\u4e2a\u4eba\u8be6\u60c5URL,item[1]\u5934\u50cfURL,item[2]\u59d3\u540d,item[3]\u5e74\u9f84,item[4]\u5c45\u4f4f\u5730\n            print u\"\u53d1\u73b0\u4e00\u4f4d,\u540d\u5b57\u53eb\",item[2],u\"age\",item[3],u\",\u5728\",item[4]\n            print u\"\u6b63\u5728\u4fdd\u5b58\",item[2],\"\u7684\u4fe1\u606f\"\n            print u\"\u4e2a\u4eba\u5730\u5740\u662f\",item[0]\n            #\u4e2a\u4eba\u8be6\u60c5\u9875\u9762\u7684URL\n            detailURL = item[0]\n            #\u5f97\u5230\u4e2a\u4eba\u8be6\u60c5\u9875\u9762\u4ee3\u7801\n            detailPage = self.getDetailPage(detailURL)\n            #\u83b7\u53d6\u4e2a\u4eba\u7b80\u4ecb\n            brief = self.getBrief(detailPage)\n            #\u83b7\u53d6\u6240\u6709\u56fe\u7247\u5217\u8868\n            images = self.getAllImg(detailPage)\n            self.mkdir(item[2])\n            #\u4fdd\u5b58\u4e2a\u4eba\u7b80\u4ecb\n            self.saveBrief(brief,item[2])\n            #\u4fdd\u5b58\u5934\u50cf\n            self.saveIcon(item[1],item[2])\n            #\u4fdd\u5b58\u56fe\u7247\n            self.saveImgs(images,item[2])\n\n    #\u4f20\u5165\u8d77\u6b62\u9875\u7801\uff0c\u83b7\u53d6\u56fe\u7247\n    def savePagesInfo(self,start,end):\n        for i in range(start,end+1):\n            print u\"\u6b63\u5728\u627e\u7b2c\",i,u\"\u4e2a\u5730\u65b9\uff0c\u770b\u770b\u5728\u4e0d\u5728\"\n            self.savePageInfo(i)\n```\n\n#\u4f20\u5165\u8d77\u6b62\u9875\u7801\u5373\u53ef\uff0c\u5728\u6b64\u4f20\u5165\u4e862,10,\u8868\u793a\u6293\u53d6\u7b2c2\u523010\u9875\n```spider = Spider()```\n```spider.savePagesInfo(2,10)```\n\n## Request\u5e93\n\n```\n\u4f7f\u7528 Requests \u53d1\u9001\u7f51\u7edc\u8bf7\u6c42\u975e\u5e38\u7b80\u5355\u3002\n\n\n    import requests\n\n\nrequests\u5e93\u63d0\u4f9b\u4e86http\u6240\u6709\u7684\u57fa\u672c\u8bf7\u6c42\u65b9\u5f0f\n\n    r = requests.post(\"http://httpbin.org/post\")\n    r = requests.put(\"http://httpbin.org/put\")\n    r = requests.delete(\"http://httpbin.org/delete\")\n    r = requests.head(\"http://httpbin.org/get\")\n    r = requests.options(\"http://httpbin.org/get\")\n\n\u4e00\u6b21\u5b8c\u6574\u7684\u8bf7\u6c42\n\n    import requests\n    r = requests.get('https://taobao.com')\n    r.text\n\n\n\n## Scripts\n\n```\n"}